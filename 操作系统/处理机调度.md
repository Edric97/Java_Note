# 处理机调度

## 一、概述

### 1、什么是调度？为什么要引进调度？

同一时间段内任务很多，但是资源有限，无法同时处理。

因此需要确定某种规则来确定任务（指的是作业或者进程）的执行顺序。

## 2、三个层次

```markdown
1、高级调度（作业调度）
		（外存 ——》 内存	面向作业）—— 作业：用户给计算机提交任务的任务实体。一般一个作业由多个进程组成。
		 从外存的后备队列中按一定的原则扔一个作业给内存，并创建相应进程
		 只看进程的话，由 无 ——》创建态 ——》就绪态
2、中级调度（内存调度）
		（外存 ——》 内存	面向进程）
		 指的是使用了虚拟存储技术的操作系统，将被扔在外存中的进程（此时该进程为挂起态，虽然进程在外存，但是其PCB不在外存，而是常驻内存），操作系统决定将哪个挂起态的进程重新调入内存。
		 只看进程的话，由 挂起态 ——》就绪态 或者 阻塞挂起 ——》阻塞态
3、低级调度（进程调度）
		（仅在内存中的进程调度，也是最基本的调度）
		 处理的是从就绪队列中选一个进程，分配处理机给它
```

所谓的进程七状态模型，就是在五状态模型的基础上，加上了两个挂起状态——就绪挂起 和 等待挂起。

原先的无状态都是低级调度，也就是进程调度，都是在内存里面的。两个挂起状态，则是会被放在外存。

## 二、进程调度

进程调度，就是上面提到的低级调度，因为出现的频率最高，所以我们将重点研究它。

### 1、进程调度的时机

#### 1.1 需要进行进程调度的情况

```markdown
1、主动放弃CPU
		1.1 进程正常终止
		1.2 运行过程中发生异常而终止
		1.3 进程主动请求阻塞（如等待I/O）
2、被动放弃CPU
		2.1 分给进程的时间片用完
		2.2 有更紧急的事要处理（如I/O中断）
		2.3 有更高优先级的进程进入就绪队列
```

#### 1.2 不能进行进程调度的情况

```markdown
1、正在处理中断的过程中
2、进程在操作系统内核程序临界区中
		内核程序临界区：用来访问某种内核数据结构的。因为要快速访问内核资源，防止CPU等待时间过长，因为在内核临界区中不能进行进程调度
		“内核”两个字就已经区别于一般的临界区：其他临界区访问的是一般资源，比如说打印机，因为打印机慢，不能让进程边占用CPU，边等打印机，所以在别的临界区中，是可以进程的调度的
3、在原子操作过程中（eg.原语）
```

### 2、进程调度的方式

```markdown
1、非剥夺调度方式/非抢占式方式
		系统只允许进程主动放弃CPU
2、剥夺调度方式/抢占式方式
```

## 三、调度算法的评价指标

其实就是解释一堆名词

#### 1、CPU利用率

```latex
CPU利用率 = $\frac{忙碌时间}{总时间}$
```

#### 2、系统吞吐量

描述了单位时间内完成作业的数量

```latex
系统吞吐量 = $\frac{总共完成作业的数量}{总共花的时间}$
```

#### 3、周转时间

提交作业 开始一直到 作业完成 的这段时间的时间间隔

这又包括了四个部分：

​	高级调度（作业在后备队列中等待的）时间 + 低级调度（进程在就绪队列中等待的）时间 + CPU执行所需要的时间 + 等待I/O完成的时间

以上四部分的后三者，一个作业的整个处理过程中，可能会发生多次

#### 4、等待时间

进程/作业处于等待处理机状态的时间之和

#### 5、响应时间

用户提交请求到首次产生响应所用的时间

## 四、基础调度算法

```markdown
1、先来先服务（FCFS）—— 非抢占式
		长作业友好，但是短作业的加权周转时间会很大，短作业用户体验差
2、短作业优先（SJF）—— 非抢占式（但是也有抢占式的版本 —— 最短剩余时间优先算法SRTN）
		短作业友好，但是长作业不友好，可能会产生饥饿现象，甚至饿死
3、高响应比优先（HRRN）——非抢占式
		响应比 = 1 + \frac{等待时间}{要求服务时间}
```

## 五、进阶调度算法

```markdown
1、时间片轮转调度算法（RR）——抢占式
		时间片太大，会退化成先来先服务算法
		时间片太小，进程切换会过于频繁
2、优先级调度算法 —— 抢占式 和 非抢占式 都有
		优先级也可以动态变化，适用于实时操作系统
3、多级反馈队列调度算法 —— 抢占式
		等待队列有多个，且按优先级分类。每个队列对应的时间片，也不一样，一般是高优先级级队列，时间片小。
		该算法综合了上面所有提到的算法，但是可能会有饥饿发生。
```

