# 文件管理

## 一、概述

### 1、什么是文件

术语：文件是以计算机为载体的存储在计算机上的信息集合。

### 2、文件包含了哪些东西

```markdown
1、存储空间中的数据
2、分类和索引的信息
3、访问权限的信息
```

### 3、文件的打开

使用系统调用open将指明文件的属性（包括该文件在外存上的物理地址）从外存复制到内存，并打开文件表的一个表目，并将该表目的编号返回给用户。

#### 4、什么是文件的逻辑结构、物理结构

```markdown
逻辑结构：从用户观点出发看到的文件的组织形式，与存储介质特性无关 —— 实际上不存在，是思维上的
	无结构文件（比方说：一般的程序文件）
	有结构文件（基本组成单位是记录。）（比方说：SQL表）
		有结构文件按记录的组织形式可以分为：
			顺序文件（文件是挨个存放的，但是这样不好插入新文件）
			索引文件（索引表，记录每个文件的索引号）
			索引顺序文件
物理结构：从实现观点出发看到的文件在外存上的存储组织形式，与存储介质的特性有很大关系 —— 实际上的存在
	该问题有两个方面的回答，一是文件的分配方式（对磁盘非空闲块的管理），二是文件存储空间管理（对磁盘空闲块的管理）
		文件分配方式（即对存在的文件如何管理）
			连续分配 —— 要求文件在磁盘上占有一组连续的块
			链接分配
				隐式 —— 类似于链表，对用户透明
				显式 —— 将链接信息（指针）显式地存放在内存的一张链接表中（一个文件一个表），称作FAT（File Allocation Table）表。该表在系统启动时就会被读入内存，因此查FAT的过程是在内存中进行的。
			索引分配 —— 将链接信息，全部存放在一个块中。主要的难点在于如何确定索引块的大小，太大会增加系统存储空间的开销，太小无法支持大文件。
		文件存储空间的管理（空闲的空间的管理）
			文件存储器空间首先要进行划分与初始化。
				一般来说，一个文件存储在一个文件卷中。文件卷可以是物理盘的一部分，也可以是整个物理块。一个文件卷中，文件数据信息的空间（文件区）和存放文件控制信息FCB的空间（目录区）是分离的。
			如何组织和管理空闲块：
				空闲表法
				空闲链表法
				位示图法
				成组链接法
```

### 5、什么是目录

目录其实也是一种有结构文件，不过其内容是文件控制块或者索引节点，即是具体文件（或目录）的相关信息。

为了实现目录管理，操作系统引入了文件控制块（FCB）这种数据结构，便于查找文件。

a.文件控制块的有序集合称为文件目录，即一个FCB就是一个文件目录项。FCB主要包含：`文件的基本信息（如文件名、文件的物理位置、文件的逻辑结构等），存取控制信息，使用信息`。

b.检索目录文件，只用到了文件名，因此有的系统采用了文件名和文件描述信息分开的方法，文件描述信息单独形成一个称为索引节点的数据结构，简称i节点。此时文件目录中的每个目录项仅有文件名和指向该文件所对应的i节点的指针构成。

文件被打开时，磁盘索引结点复制到内存的索引结点中，以便于使用。

FCB或索引结点相当于图书馆中图书的索引号。

### 6、什么是文件系统

文件系统，是文件管理系统的简称，是硬件上如何管理文件的一个系统软件。因此文件系统依赖于具体的存储介质，比如U盘常用的文件管理系统是NTFS（但是macOS在NTFS文件系统上只有“只读”操作，需要额外安装软件才能写文件）。当然了，除了NTFS，还有诸如FAT32等文件系统，不过这些文件系统的层次结构都不相同。

一个典型的层次结构可以包含：

```markdown
用户调用接口（为用户提供与文件及目录有关的调用，如新建、打开、读写、关闭、删除文件，建立、删除目录等）
文件目录系统（管理文件目录）
存取控制验证模块（确认访问的合法性）
逻辑文件系统与文件信息缓冲区（根据文件的逻辑结构将用户要读写的逻辑记录转换成文件逻辑块内的相应块号）
物理文件系统（将逻辑记录所在的相对块号转换成实际的物理地址）
a.辅助分配模块
b.设备管理程序模块
```

### 7、文件共享

#### 7.1 硬链接（基于索引结点）

链接都指向物理外存中同一个文件

#### 7.2 软链接（利用符号链）

一个真正的文件，其余的链接都是该文件的地址