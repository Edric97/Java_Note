# 进程

## 一、进程概述

### 1、进程的定义

```markdown
进程是正在运行着的进程实体。
```

```markdown
进程实体是由程序块、数据集、PCB（Process Control Block——进程控制块）组成的静态的实体。
```

解释：

```markdown
1、进程和程序的关系：一个进程对应一个程序，但是一个程序可能对应多个线程（这是因为同一个程序配上不同的数据集，就是不同的进程）。
2、进程和程序的关系——进阶：进程是动态的概念，程序是静态的。而且进程包含的不仅仅是程序。
3、数据集：程序需要使用的数据，以及程序执行中产生的数据或最后的数据。
4、进程和进程实体：严格来说，是有区别的，一个是静态的（进程实体），一个是动态的（进程）。但是一般情况下，不区分这两个概念。
5、PCB：进程存在的唯一标志
```

#### 1.1 PCB（程序控制块）的组成

PCB本质上来说，是一种数据结构。这是进程的唯一标识，里面存放的都是进程管理所需要的资源，比方说进程中断后保存的环境变量（以便下次进程重新进入运行态的时候，可以正确的从上次中断的地方开始重新运行）等，可见其重要性。现在让我们来详细研究一下PCB的组成。

```markdown
1、进程描述信息：
	1.1 进程标识符PID —— 具体进程被操作系统分配的唯一的、不重复的ID，用于区分不同的进程
	1.2 用户标识符UID
2、进程控制和管理信息
	2.1 进程当前状态
	2.2 进程优先级
3、资源分配清单
	3.1 程序段指针
	3.2 数据段指针
	3.3 键盘
	3.4 鼠标
4、处理机相关信息：各种寄存器值
```

### 2、进程的组织

```markdown
1、链接方式
		维护了三种指针，分别是：
			1.1 执行指针（指向的对象后面没有别的对象了，只有这一个对象。只有一个极小时间段（极小就是区别并发），因为只能有一个进程被执行）
			1.2 就绪队列指针（该指针，听名字也知道，指向一个队列头，该队列里面全是处于就绪态的进程。优先级高的会放在队头）
			1.3 阻塞队列指针（指向的队列里面的进程，全部都是处于阻塞态的进程）
2、索引方式
		和链接方式的区别仅仅是，就绪和阻塞指针，指的不是各自的队列头，而是指向各自的索引表
```

### 3、进程的特征

```markdown
1、动态性（最基本的特性）
2、并发性
3、独立性（指的是进程是资源分配、接受调度的基本单位，是独立的单位）
		注意这里：进程仅仅是接受调度的基本单位，而处理调度的基本单位则是线程。简记——线程仅在CPU里面，是CPU资源调度的最小单位。进程是除了CPU之外所有资源的最小分配单位。引入了线程，可以更好的利用CPU这个计算机中最贵重的部分。
		ps：进程的处理过程：
			加载上下文 ——》CPU执行 ——》保存上下文
		ps：上下文：
			除CPU之外的所有资源构成程序的执行环境，也称为程序的上下文。也就是说程序在CPU中跑，归线程的范畴。这个程序的上下文则是进程的范畴。
4、异步性（各进程以不可预知的速度向前推进，可能导致运行结果的不确定性）
5、结构性（分成了那三个部分）
```

## 二、进程的状态

首先我们明确一下，之所以要做这种划分，是因了方便各个不同的进程的管理，也就是为了管理进程服务的。划分以离CPU执行的远近为依据。

```markdown
1、运行态（正在CPU里面运行的进程）
2、就绪态（程序上下文已经准备好，只等着CPU了，CPU一旦空闲，就可以直接运行的进程）
3、阻塞态（程序上下文还没有准备好，还需要等除了CPU以外的其他资源的进程，比方说等待打印机等资源）
		添加阻塞态的目的：提高CPU的利用率。因为CPU是计算机中最昂贵的部分，需要先将其他进程需要的资源分配到位，才能得到CPU的服务。
下面两个相比上面三个不是那么重要：
4、创建态（创建某个进程，比如给进程分内存，初始化PCB等）
5、终止态（回收进程拥有的资源，撤销PCB）
```

ps：补充一下硬件上的知识

```markdown
CPU一般指的是物理CPU，一般家用机上只有1个物理CPU，一般服务器上有2-4个CPU。但是CPU上可能会有不止一个核心，一个核心称之为单核，多个核心称之为多核。一个核心有不止能跑一个线程，Intel的超线程技术，支持一个核心上跑两个线程。
但是对于一般的单核CPU（一般说的是只有一个CPU的情况），一个极小的时间段上只能跑一个进程。
```

## 三、进程状态的转换

自己画画图就明白了。因为状态就只有那么5个，还是比较容易的。

```markdown
创建态——》就绪态		（系统完成创建进程的一系列工作）

就绪态——》运行态		（进程被调度）

运行态——》就绪态		（时间片到了，或者处理机被抢占）

运行态——》阻塞态		（进程通过系统调用的方式申请某种系统资源，或者请求等待某个时间发生）——主动

运行态——》终止态		（进程运行结束，或运行过程中遇到不可修复的错误）

阻塞态——》就绪态		（申请的资源被分配，或等待的事件发生）——被动
```

注意：阻塞态不能直接转换为运行态，就绪态也不能直接转换为阻塞态。

## 四、进程控制

### 1、进程控制的定义

操作系统实现进程状态的转换的过程

### 2、如何实现进程控制

——》用原语操作：具体来说，就是操作系统会发送 关中断指令 和 开中断指令 ，在这两个指令之间，任何外部的中断信号都不会被收集到。

#### 2.1 原语的定义

由若干条指令组成的程序段，用来实现某个特定的功能。

具有原子性（一旦开始执行，就不能被中断，否则就会出现操作错误，造成系统混乱）

#### 2.2 进程控制的相关原语

明确一下涉及到进程控制的原语操作的目的是：

```markdown
1、更新PCB信息
2、将PCB插入合适的队列
3、分配或者回收资源
```

注意：阻塞原语 和 唤醒原语要成对出现

## 五、进程通信

### 1、什么是进程通信

是进程之间的信息交换。

### 2、为什么要进行进程的通信

```markdown
1、数据传输：
		一个进程将它的数据发送给另一个进程
2、通知事件：
		一个进程向另一个（另一组）进程发送消息，通知它（它们）发生了某种事件（比如子进程终止时，要通知父进程）
3、资源共享：
		多个进程共享同样的资源。为了做到这一点，需要内核提供互斥和同步机制。
4、进程控制：
		有些进程希望完全控制另一个进程的执行（比如Debug进程），此时控制进程希望能够拦截另一个进程的所有陷入和异常，并能够及时知道它的状态改变。
```

### 3、进程通信的具体方式

```markdown
1、共享存储（就是开辟了一个共享空间，里面可以填下面这两个东西。很明显，进程访问共享空间必须要互斥——P.V操作）
	1.1 基于数据结构的共享（低级）
	1.2 基于存储区的共享（高级）
2、管道通信（在内存中开辟一个大小固定的缓冲区，称作管道——本质上还是个共享文件）
	ps：a.管道只支持半双工通信，即某一个时间段内数据只能单向传输。
		  b.进程必须互斥访问管道，即：
		  	b.1 写满才能读，读空才能写
		  	b.2 被读完数据，该数据就会被管道抛弃 ——》读进程只能有一个
3、消息传递（使用操作系统提供的“发送/接收消息”，这两个原语进行数据交换。这里的数据，是格式化的数据，包括了消息头和消息体，消息头又包括了发送进程的ID，接受进程的ID，消息类型，消息长度等等）
	3.1 直接通信方式（消息直接挂到接收进程的消息缓冲队列）
	3.2 间接通信方式（消息先发送到中间实体（一般被称作信箱），接收和发送都用原语控制）
```

